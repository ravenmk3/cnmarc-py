# CNMARC - 中国机读目录格式

## 参考资料

- [MARC 21 Bibliographic](https://www.loc.gov/marc/bibliographic/bdintro.html)
- [CNMARC 格式详解](https://www.renrendoc.com/paper/154230264.html)

## 数据分隔符

| 分隔符       | ASCII                             | 描述 |
| ------------ | --------------------------------- | ---- |
| 记录结束符   | 29 / 0x1D / GS (Group Separator)  |      |
| 字段分隔符   | 30 / 0x1E / RS (Record Separator) |      |
| 子字段分隔符 | 31 / 0x1F / US (Unit Separator)   |      |

## 记录格式

每一个 MARC 记录表示一个书目的信息，由三个区域加上记录结束符组成。需要注意每个记录结束后可能会跟着回车换行符 `\r\n`。

💡注意，MARC 是文本格式，非二进制格式

| 区域                         | 长度                | 描述                   |
| ---------------------------- | ------------------- | ---------------------- |
| 记录头标 (Leader)            | 24                  |                        |
| 地址目次区 (Directory)       | 变长, 12 的倍数 + 1 | 以字段分隔符 (RS) 结尾 |
| 数据字段区 (Variable fields) | 变长                |                        |
| 记录结束符                   | 1                   | (GS)                   |

## 记录头标

## 地址目次区

## 数据字段区

## 读取方式

不管哪种方式，注意移除掉数据起始或结束部分的回车换行符

- 方式1：从流中顺序读，读到记录结束符时 (GS)，得到完整的记录数据，再细分解析。
- 方式2：从流中顺序读，先读出记录头标，从记录头标获取记录长度 (包括记录结束符)，再一次性读取整个记录长度减去头标长度的数据，得到完整记录数据。
